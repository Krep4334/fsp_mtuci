# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å TBD –∫–æ–º–∞–Ω–¥–∞–º–∏

## –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –º–∞—Ç—á–µ–π, –ø–æ–±–µ–¥–∏—Ç–µ–ª–∏ –Ω–µ –ø—Ä–æ–¥–≤–∏–≥–∞—é—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–∏–µ —Ä–∞—É–Ω–¥—ã (TBD –∫–æ–º–∞–Ω–¥—ã –æ—Å—Ç–∞—é—Ç—Å—è TBD).

## –ü—Ä–∏—á–∏–Ω–∞
–°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∞ –≤ –∫–æ–¥–µ (`team1Id` –∏ `team2Id` —Ç–µ–ø–µ—Ä—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ), –Ω–æ –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

## –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
node apply-migration.js
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ Prisma –Ω–∞–ø—Ä—è–º—É—é

```bash
cd server

# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç
npx prisma generate

# –°–æ–∑–¥–∞—Ç—å –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
npx prisma migrate dev --name make_team_ids_optional

# –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
npx prisma db push
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ SQL

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `server/migrate-match-optional.sql`
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∑–∞–ø—Ä–æ—Å—ã –≤ –≤–∞—à–µ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### –í–∞—Ä–∏–∞–Ω—Ç 4: –£–¥–∞–ª–∏—Ç—å –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –±–∞–∑—É (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏!)

```bash
cd server

# –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
rm prisma/dev.db  # –¥–ª—è SQLite

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –±–∞–∑—É
npx prisma migrate dev

# –ò–ª–∏ –ø—Ä–æ—â–µ - —Ä–µ—Å–µ—Ç
npx prisma migrate reset
```

## –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏

1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π —Ç—É—Ä–Ω–∏—Ä –≤ `/debug`
3. –ó–∞–≤–µ—Ä—à–∏—Ç–µ –º–∞—Ç—á–∏ –ø–µ—Ä–≤–æ–≥–æ —Ä–∞—É–Ω–¥–∞
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–æ–º–∞–Ω–¥—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ä–∞—É–Ω–¥–µ

## –ü—Ä–æ–≤–µ—Ä–∫–∞

–í –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –º–∞—Ç—á–∞ –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è:
```
üèÜ –†–µ–∑—É–ª—å—Ç–∞—Ç –º–∞—Ç—á–∞: 3 - 1, –ø–æ–±–µ–¥–∏—Ç–µ–ª—å: team-id
üîç –ü–æ–∏—Å–∫ —Å–ª–µ–¥—É—é—â–µ–≥–æ –º–∞—Ç—á–∞: —Ä–∞—É–Ω–¥ 2, –ø–æ–∑–∏—Ü–∏—è 1
üìù –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞—Ç—á–∞: –ø–æ–∑–∏—Ü–∏—è 1 -> team1
‚úÖ –ü–æ–±–µ–¥–∏—Ç–µ–ª—å team-id –ø—Ä–æ–¥–≤–∏–Ω—É—Ç –≤ —Ä–∞—É–Ω–¥ 2, –ø–æ–∑–∏—Ü–∏—è 1
```

## –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–ª–∞—Å—å

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ - —Ç–∞–º –±—É–¥—É—Ç –¥–µ—Ç–∞–ª–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞:
   ```bash
   cd server
   npx prisma studio
   ```
   –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É `matches` –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `team1Id` –∏ `team2Id` –º–æ–≥—É—Ç –±—ã—Ç—å NULL

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ `schema.prisma` –Ω–∞–ø–∏—Å–∞–Ω–æ:
   ```prisma
   team1Id String?
   team2Id String?
   ```
   (—Å–æ –∑–Ω–∞–∫–æ–º –≤–æ–ø—Ä–æ—Å–∞!)

## –î–ª—è production

```bash
cd server
npx prisma migrate deploy
```
